<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
    <script src="../lib/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="eventing.js"></script>
    <script src="dobi.js"></script>

    <title>Binding Declarative Approach</title>
</head>

<body>

    <div id="templates">

        <div data-def-template="dropdown(entries,metadata)">

            <select id="dropdown" data-bind="entries">
                <option>
                    <script>
                        dobi.script(function(info) {

                            var metadata = info.resolve('metadata').value();

                            var selectedEntryProperty = info.resolve('../');
                            var selectedValue = selectedEntryProperty.resolve(metadata.valuePath).value();

                            var entryProperty = info.resolve('.');
                            var value = entryProperty.resolve(metadata.valuePath).value();
                            var description = entryProperty.resolve(metadata.descriptionPath).value();

                            info.parentNode.setAttribute('value', value);
                            info.parentNode.textContent = description;

                            if (selectedEntryProperty.value() === entryProperty.value())
                                info.parentNode.setAttribute('selected', 'selected');
                            else
                                info.parentNode.removeAttribute('selected');

                        });
                    </script>
                </option>
            </select>

            <script>
                dobi.script(function(info) {

                    var metadata = info.resolve('metadata').value();
                    var dropdown = info.getElementById('dropdown');
                    var entriesProperty = info.resolve('entries');
                    var selectedEntryProperty = info.resolve('.');

                    dropdown.addEventListener('click', function() {
                        for (var i = 0; i < entriesProperty.value().length; ++i) {
                            var entryProperty = entriesProperty.resolve("" + i);
                            var value = entryProperty.resolve(metadata.valuePath).value();
                            if (value === dropdown.value) {
                                selectedEntryProperty.set(entryProperty.value());
                            }
                        }
                    });

                });
            </script>

        </div>


        <!-- model -->

        <h1>Model</h1>
        <div data-bind="modelEditor/model">


            <h2>DataSource</h2>
            <div data-bind="DataSource">
                <div>
                    <span>ObjectName:</span>
                    <input data-bind="ObjectName">
                </div>
                <div>
                    <span>PackageName:</span>
                    <input data-bind="PackageName">
                </div>
                <div>
                    <span>Type:</span>
                    <input data-bind="Type">
                </div>
            </div>

            <button id="LoadModel">Load</button>
            <script>
                dobi.script(function(info) {
                    info.getElementById('LoadModel').addEventListener('click', function() {
                        repository.getModel('test', function(model) {
                            modelEditor.setDimension(model.Dimensions[0]);
                            modelEditor.setModel(model);
                        });
                    });
                });
            </script>
            <div>
                <span>Description:</span>
                <input data-bind="Description">
            </div>

            <h1>Dimension</h1>


            <div data-bind="modelEditor/dimension" data-template="dropdown" data-template-parameters="Dimensions,dimensionDropdown"></div>

            <div data-bind="modelEditor/dimension">
                <ul data-bind="Attributes">
                    <li>
                        Id:
                        <input data-bind="Id">Name:
                        <input data-bind="Name">Freestyle:
                        <input type="checkbox" data-bind="AccessUsage/FreestyleSearch">
                        <br>PresentationUsage:
                        <ul data-bind="dict:PresentationUsage">
                            <li>
                                <input data-bind="key">
                                <input data-bind="value">
                                <button id="DelPresentationUsage">Del</button>
                                <script>
                                    dobi.script(function(info) {
                                        info.getElementById('DelPresentationUsage').addEventListener('click', function() {
                                            var key = info.resolve('key').value();
                                            var attribute = info.resolve('../').value();
                                            attribute.PresentationUsage.dictDel(key);
                                        });
                                    });
                                </script>
                            </li>
                        </ul>
                        <button id="AddPresentationUsage">Add</button>
                        <script>
                            dobi.script(function(info) {
                                info.getElementById('AddPresentationUsage').addEventListener('click', function() {
                                    var attribute = info.resolve('.').value();
                                    attribute.PresentationUsage.dictSet('name', 'value');
                                });
                            });
                        </script>
                    </li>
                </ul>
            </div>

        </div>


        <!-- cube -->
        <h1>Cube</h1>
        <div data-bind="cubeEditor/cube">

            <h2>DataSource</h2>
            <div data-bind="DataSource">
                <div>
                    <span>ObjectName:</span>
                    <input data-bind="ObjectName">
                </div>
                <div>
                    <span>PackageName:</span>
                    <input data-bind="PackageName">
                </div>
                <div>
                    <span>Type:</span>
                    <input data-bind="Type">
                </div>
            </div>

            <button id="LoadCube">Load</button>
            <script>
                dobi.script(function(info) {
                    info.getElementById('LoadCube').addEventListener('click', function() {
                        repository.getCube('test', function(cube) {
                            cubeEditor.setDimension(cube.Dimensions[0]);
                            cubeEditor.setCube(cube);
                        });
                    });
                });
            </script>

            <h1>Dimension</h1>

            <div data-bind="cubeEditor/dimension" data-template="dropdown" data-template-parameters="Dimensions,dimensionDropdown"></div>
            
            <div data-bind="cubeEditor/dimension">
                <ul data-bind="Attributes">
                    <li>
                        <input type="checkbox" data-bind="selected">
                        <span data-bind="Name"></span>
                    </li>
                </ul>
                
            </div>
            
        </div>

    </div>

    <div id="target"></div>
    <script src="modeleditor.js"></script>

</body>

</html>