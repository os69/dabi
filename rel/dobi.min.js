!function(){var e=window.define||function(e,r){window.dobi=window.dobi||{},window.dobi.eventing=r()};e([],function(){"use strict";var e={};window.eventing=e;var r=function(e,r){for(var t in r)e[t]=r[t];return e};e.ProcessedObjects=function(){this.init.apply(this,arguments)},e.ProcessedObjects.prototype={init:function(e){if(this.processedObjects=[],e)for(var r=0;r<e.length;r++){var t=e[r];this.processedObjects.push({receiver:t.receiver,handlerName:t.handlerName})}},addProcessedObject:function(e,r){this.isProcessedObject(e,r)||this.processedObjects.push({receiver:e,handlerName:r})},isProcessedObject:function(e,r){for(var t=0;t<this.processedObjects.length;t++){var s=this.processedObjects[t];if(s.receiver===e&&s.handlerName===r)return!0}return!1}},e.Event=function(){this.init.apply(this,arguments)},e.Event.prototype={init:function(e){r(this,e)}},e.EventProperties=function(){this.init.apply(this,arguments)},e.EventProperties.prototype={init:function(e){this.obj=e,this.receivers={},this.senders={},this.decorators={},this.autoDelete=!1},setAutoDelete:function(e){this.autoDelete={receiverLimit:e}},addReceiver:function(e,r,t){var s=this.receivers[e];s||(s=[],this.receivers[e]=s);for(var n=0;n<s.length;n++){var i=s[n];if(i.receiver===r&&i.handler===t)return!1}return s.push({receiver:r,handler:t}),!0},removeReceiver:function(e,r,t){var s=this.receivers[e];if(s){for(var n=0;n<s.length;n++){var i=s[n];if(i.receiver===r&&i.handler===t)return s.splice(n,1),!0}return!1}},getReceivers:function(e){var r=[],t=this.receivers[e];if(!t)return r;for(var s=0;s<t.length;s++){var n=t[s];r.push({receiver:n.receiver,handler:n.handler})}return r},getNumberReceivers:function(e){var r=this.receivers[e];return r?r.length:0},isReceiver:function(e,r,t){var s=this.receivers[e];if(!s)return!1;for(var n=0;n<s.length;n++){var i=s[n];if(i.receiver===r&&i.handler===t)return!0}return!1},getAllReceivers:function(){var e=[];for(var r in this.receivers)for(var t=this.receivers[r],s=0;s<t.length;s++){var n=t[s];e.push({signal:r,receiver:n.receiver,handler:n.handler})}return e},getNumberAllReceivers:function(){var e=0;for(var r in this.receivers){var t=this.receivers[r];e+=t.length}return e},addSender:function(e,r,t){var s=this.senders[r];s||(s=[],this.senders[r]=s);for(var n=0;n<s.length;n++){var i=s[n];if(i.sender===e&&i.handler===t)return!1}return s.push({sender:e,handler:t}),!0},removeSender:function(e,r,t){var s=this.senders[r];if(s){for(var n=0;n<s.length;n++){var i=s[n];if(i.sender===e&&i.handler===t)return s.splice(n,1),!0}return!1}},getAllSenders:function(){var e=[];for(var r in this.senders)for(var t=this.senders[r],s=0;s<t.length;s++){var n=t[s];e.push({sender:n.sender,signal:r,handler:n.handler})}return e}};var t="__eventing__";return r(e,{defaultSender:{},defaultReceiver:{},getEventProperties:function(r){var s=r[t];return s||(s=new e.EventProperties(r),r[t]=s),s},setAutoDelete:function(e,r){this.getEventProperties(e).setAutoDelete(r)},scounter:0,subscribe:function(r,t,s,n){r=r||e.defaultSender,s=s||e.defaultReceiver;var i=this.getEventProperties(r).addReceiver(t,s,n),c=this.getEventProperties(s).addSender(r,t,n);if(i!==c)throw"Inconsistency";i&&c&&this.scounter++},unSubscribe:function(e,r,t,s){var n=this.getEventProperties(e).removeReceiver(r,t,s),i=this.getEventProperties(t).removeSender(e,r,s);if(n!==i)throw"Inconsicenty";n&&i&&this.scounter--;var c=this.getEventProperties(e).autoDelete;c&&this.getEventProperties(e).getNumberAllReceivers()<=c.receiverLimit&&this.deleteSubscriptions(e),e.afterUnSubscribe&&e.afterUnSubscribe(e,r,t,s);for(var o=0;o<this.unSubscribeListeners.length;++o){var a=this.unSubscribeListeners[o];a(e,r,t,s)}},unSubscribeListeners:[],addUnSubscribeListener:function(e){this.unSubscribeListeners.push(e)},removeUnSubscribeListener:function(e){var r=this.unSubscribeListeners.indexOf(e);r>=0&&this.unSubscribeListeners.splice(r,1)},raiseEvent:function(r,t,s){r=r||e.defaultSender;var n=new e.Event({sender:r,signal:t,message:s}),i=[],c=function(e,r,t,s){e===n.sender&&r===n.signal&&i.push({receiver:t,handler:s})};this.addUnSubscribeListener(c);for(var o=this.getEventProperties(r).getReceivers(t),a=0;a<o.length;a++){for(var v=o[a],u=!1,h=0;h<i.length;++h){var d=i[h];d.receiver===v.receiver&&d.handler===v.handler&&(u=!0)}if(!u){var l=v.handler;"string"==typeof l&&(l=v.receiver[l]);try{l.apply(v.receiver,[n])}catch(f){throw this.removeUnSubscribeListener(c),f}}}this.removeUnSubscribeListener(c)},deleteSubscriptions:function(e){if(e[t]){for(var r=this.getEventProperties(e).getAllReceivers(),s=0;s<r.length;s++){var n=r[s];this.unSubscribe(e,n.signal,n.receiver,n.handler)}for(var i=this.getEventProperties(e).getAllSenders(),c=0;c<i.length;c++){var o=i[c];this.unSubscribe(o.sender,o.signal,e,o.handler)}e.afterDeleteSubscriptions&&e.afterDeleteSubscriptions()}}}),r(e,{noMethodCall:{label:"no method call"},generateHandler:function(r,t){return function(s){if(!s.message.processedObjects.isProcessedObject(this,r)){s.message.processedObjects.addProcessedObject(this,r);var n=s.message.args;if(t){var i=[];i.push.apply(i,s.message.args),i.push(s.sender,this),n=t.apply(null,i)}var c=this[r];if(!c||n===e.noMethodCall)return n===e.noMethodCall&&(n=s.message.args),void e.raiseEvent(this,r,{args:n,processedObjects:s.message.processedObjects});var o=e.getEventProperties(this),a=o.decorators["event_"+r];a&&(a.processedObjects=s.message.processedObjects),c.apply(this,n)}}},decorate:function(r,t){var s=r[t];if(s){var n=e.getEventProperties(r);if(!n.decorators["event_"+t]){var i=function(){var r;i.processedObjects?(r=i.processedObjects,i.processedObjects=null):(r=new e.ProcessedObjects,r.addProcessedObject(this,t));var n=s.apply(this,arguments);return 0!==arguments.length&&e.raiseEvent(this,t,{args:arguments,processedObjects:r}),n};i.originalMethod=s,r[t]=i,n.decorators["event_"+t]=i}}},connect:function(e,r,t,s,n,i){arguments.length<=4?(this.connectSingle(e,r,t,s),this.connectSingle(t,s,e,r)):(n&&(n instanceof Function?this.connectSingle(e,r,t,s,n):this.connectSingle(e,r,t,s)),i&&(i instanceof Function?this.connectSingle(t,s,e,r,i):this.connectSingle(t,s,e,r)))},connectSingle:function(r,t,s,n,i){this.decorate(r,t),e.subscribe(r,t,s,this.generateHandler(n,i))},subscribeToMethodCall:function(r,t,s,n){this.decorate(r,t),e.subscribe(r,t,s,n)},unSubscribeToMethodCall:function(r,t,s,n){e.unSubscribe(r,t,s,n)},raiseMethodEvent:function(r,t,s){var n=new e.ProcessedObjects;n.addProcessedObject(r,t),e.raiseEvent(r,t,{args:s,processedObjects:n})}}),e})}();
!function(){"use strict";var n=window.define||function(n,i){window.dobi=window.dobi||{},window.dobi.list=i()};n([],function(){var n=function(n,i,r,t){r||(r=function(n,i){return n===i}),t||(t=function(){});for(var e=function(n,i,t){for(var e=i;e<n.length;++e)if(r(t,n[e]))return e;return-1},o=function(n,i,r,t){for(var o=i;o<n.length;++o){var u=e(r,t,n[o]);if(u>=0)return{i1:o,i2:u}}return{i1:n.length,i2:r.length}},u=0,f=0;u<n.length||f<i.length;){var a=n[u],l=i[f];if(a&&l&&r(a,l))t(a,l),u++,f++;else{var c=o(n,u,i,f),v=c.i1-u,d=i.slice(f,c.i2),h=[u,v];h.push.apply(h,d),n.splice.apply(n,h),c.i2<n.length&&t(n[c.i2],i[c.i2]),u=f=c.i2+1}}},i=function(n,i){for(var r={},t=0;t<n.length;++t){var e=n[t];r[i(e)]=e}return r};return{deltaSet:n,createMap:i}})}();
!function(){var t=window.define||function(t,e){window.dobi=window.dobi||{},window.dobi.property=e(window.dobi.eventing)};t(["dobi/eventing"],function(t){var e={};return e.setterName=function(t){return"set"+t[0].toUpperCase()+t.slice(1)},e.generateSetter=function(t,s){var i=e.setterName(s);t[i]||(t[i]=function(t){this[s]=t})},e.setProperty=function(t,s,i){if(i!==t[s])if("[object Array]"===Object.prototype.toString.call(t)){var r=parseInt(s);t.splice(r,1,i)}else e.generateSetter(t,s),t[e.setterName(s)].apply(t,[i])},e.isList=function(t){return"[object Array]"===Object.prototype.toString.call(t)?!0:!1},e.PROPERTY_TYPE_SIMPLE=1,e.PROPERTY_TYPE_STATIC=2,e.PROP_EVENT_TYPE_CHANGE="property_change",e.PROP_EVENT_TYPE_CHANGE_PUSH="property_change_push",e.PROP_EVENT_TYPE_CHANGE_SPLICE="property_change_splice",e.PROP_EVENT_TYPE_DELETE="delete",e.PROP_EVENT_TYPE_UPDATE_LIST_INDEX="list_update_list_index",e.Property=function(){this.init.apply(this,arguments)},e.Property.prototype={init:function(s){this.type=s.type,this.eventTypes=s.eventTypes,this.object=s.object,this.path=""+s.path,this.listening=!1,this.targetList=null,this.type||(this.type=e.PROPERTY_TYPE_SIMPLE),this.type===e.PROPERTY_TYPE_STATIC?this.staticValue=s.value:this.pathParts=this.pathParts(this.object,this.path),this.eventTypes||(this.eventTypes=[e.PROP_EVENT_TYPE_CHANGE,e.PROP_EVENT_TYPE_CHANGE_PUSH,e.PROP_EVENT_TYPE_CHANGE_SPLICE,e.PROP_EVENT_TYPE_DELETE,e.PROP_EVENT_TYPE_UPDATE_LIST_INDEX]),t.setAutoDelete(this,0)},resolve:function(t){return"."===t?this:e.objectProperty(this.value(),t)},resolveValue:function(t){return this.resolve(t).value()},listIndex:function(){var t=this.pathParts[this.pathParts.length-1];return parseInt(t.propertyName)},pathParts:function(t,e){for(var s=e.split("/"),i=[],r=0;r<s.length;++r){var a=s[r];i.push({object:t,propertyName:a}),t=t?t[a]:void 0}return i},reParsePath:function(t){t||(t=0);for(var e=t;e<this.pathParts.length;++e){var s=this.pathParts[e];if(0!==e){var i=this.pathParts[e-1];s.object=i.object?i.object[i.propertyName]:void 0}}},get:function(){if(this.type===e.PROPERTY_TYPE_STATIC)return this.staticValue;var t=this.pathParts[this.pathParts.length-1];return t.object?t.object[t.propertyName]:void 0},set:function(t){if(this.type===e.PROPERTY_TYPE_STATIC)throw"Cannot change static property";var s=this.pathParts[this.pathParts.length-1];if(!s.object)throw void 0;e.setProperty(s.object,s.propertyName,t)},value:function(t){return 0===arguments.length?this.get():this.set(t)},subscribe:function(s,i){if(this.type===e.PROPERTY_TYPE_STATIC){if(!e.isList(this.staticValue))return;return this.targetList=this.staticValue,t.subscribeToMethodCall(this.targetList,"push",this,this.attributeChanged),t.subscribeToMethodCall(this.targetList,"splice",this,this.attributeChanged),void t.subscribe(this,"propertyChanged",s,i)}return t.subscribe(this,"propertyChanged",s,i),this.listening||(this.reParsePath(),this.listenToObjects()),this},unSubscribe:function(s,i){if(this.type===e.PROPERTY_TYPE_STATIC){if(!e.isList(this.staticValue))return;return this.targetList=null,t.unSubscribeToMethodCall(this.targetList,"push",this,this.attributeChanged),t.unSubscribeToMethodCall(this.targetList,"splice",this,this.attributeChanged),void t.unSubscribe(this,"propertyChanged",s,i)}return t.unSubscribe(this,"propertyChanged",s,i),this},afterDeleteSubscriptions:function(){this.listening=!1},listenToObjects:function(s){var i;s||(s=0);for(var r=s;r<this.pathParts.length;++r)i=this.pathParts[r],i.object&&this.listenToObject(i);if(i=this.pathParts[this.pathParts.length-1],i&&i.object){var a=i.object[i.propertyName];e.isList(a)&&(this.targetList=a,t.subscribeToMethodCall(this.targetList,"push",this,this.attributeChanged),t.subscribeToMethodCall(this.targetList,"splice",this,this.attributeChanged))}this.listening=!0},unListenToObjects:function(e){e||(e=0);for(var s=e;s<this.pathParts.length;++s){var i=this.pathParts[s];i.object&&this.unListenToObject(i)}this.targetList&&(t.unSubscribeToMethodCall(this.targetList,"push",this,this.attributeChanged),t.unSubscribeToMethodCall(this.targetList,"splice",this,this.attributeChanged),this.targetList=null),this.listening=!1},listenToObject:function(s){e.isList(s.object)?(t.subscribeToMethodCall(s.object,"push",this,this.attributeChanged),t.subscribeToMethodCall(s.object,"splice",this,this.attributeChanged)):(e.generateSetter(s.object,s.propertyName),t.subscribeToMethodCall(s.object,e.setterName(s.propertyName),this,this.attributeChanged))},unListenToObject:function(s){e.isList(s.object)?(t.unSubscribe(s.object,"push",this,this.attributeChanged),t.unSubscribe(s.object,"splice",this,this.attributeChanged)):t.unSubscribe(s.object,e.setterName(s.propertyName),this,this.attributeChanged)},isChanged:function(t,e){var s=this.pathParts[t];switch(e.signal){case"push":return!1;case"splice":var i=e.message.args[0],r=e.message.args[1],a=e.message.args.length-2,h=parseInt(s.propertyName);return i>h?!1:0===a&&0===r?!1:a===r&&h>=i+a?!1:!0;default:return!0}},raisePropertyChanged:function(e,s){this.eventTypes.indexOf(e)<0||t.raiseEvent(this,"propertyChanged",{type:e,value:this.value(),originalEvent:s})},attributeChanged:function(t){var s;if(t.sender!==this.targetList){for(var i=0;i<this.pathParts.length&&(s=this.pathParts[i],s.object!==t.sender);++i);if(i===this.pathParts.length)throw"Error identifying sender";this.isChanged(i,t)&&(e.isList(s.object)?this.attributeChangedList(i,t):this.attributeChangedObject(i,t))}else switch(t.signal){case"push":this.raisePropertyChanged(e.PROP_EVENT_TYPE_CHANGE_PUSH,t);break;case"splice":this.raisePropertyChanged(e.PROP_EVENT_TYPE_CHANGE_SPLICE,t)}},attributeChangedList:function(t,s){var i=this.pathParts[t],r=parseInt(i.propertyName);switch(s.signal){case"splice":var a=s.message.args[0],h=s.message.args[1],n=s.message.args.length-2;if(a>r)return;if(r>=a&&a+h>r)return this.path+="!DELETED!",i.propertyName="-1",this.unListenToObjects(),void this.raisePropertyChanged(e.PROP_EVENT_TYPE_DELETE,s);this.path="!SEE_PATH_PARTS!";var o=r-h+n;i.propertyName=""+o,this.raisePropertyChanged(e.PROP_EVENT_TYPE_UPDATE_LIST_INDEX,s);break;default:throw"Not allowed method "+s.signal}},attributeChangedObject:function(t,s){this.unListenToObjects(t+1),t+1<this.pathParts.length&&(this.pathParts[t+1].object=this.pathParts[t].object[this.pathParts[t].propertyName],this.reParsePath(t+1)),this.listenToObjects(t+1),this.raisePropertyChanged(e.PROP_EVENT_TYPE_CHANGE,s)}},e.objectProperty=function(t,s){return new e.Property({object:t,path:s,type:e.PROPERTY_TYPE_SIMPLE})},e.listItemProperty=function(t,s){return new e.Property({object:t,path:s,type:e.PROPERTY_TYPE_SIMPLE})},e.staticProperty=function(t){return new e.Property({value:t,type:e.PROPERTY_TYPE_STATIC})},e.wrapAsProperty=function(t){return t instanceof e.Property?t:e.staticProperty(t)},e})}();
!function(){var e=window.define||function(e,t){window.dobi=window.dobi||{},window.dobi.binding=t(window.dobi.eventing,window.dobi.property)};e(["dobi/eventing","dobi/property"],function(e,t){var n={};return n.run=function(e,t,r){r||(r=document.createElement("div"),document.body.appendChild(r)),n.bindObject(e,r,n.parseTransformationFromTemplate(t)),t.parentNode.removeChild(t)},n.loadHtml=function(e){var t=new XMLHttpRequest;if(t.open("GET",e,!1),t.send(null),200!==t.status)throw"HTTP GET failed:"+e;document.write(t.responseText)},n.unbind=function(t){e.deleteSubscriptions(t);for(var r=0;r<t.childNodes.length;++r){var i=t.childNodes.item(r);n.unbind(i)}},n.unbindChildren=function(e){for(var t=0;t<e.childNodes.length;++t){var r=e.childNodes.item(t);n.unbind(r)}},n.bindString=function(e,t,r,i){t.nodeType===Node.TEXT_NODE?n.bindTextNode(e,t,r,i):"INPUT"===t.tagName?"checkbox"===t.getAttribute("type")?n.bindCheckbox(e,t,r,i):n.bindStringInput(e,t,r,i):n.bindStringElement(e,t,r)},n.bindTextNode=function(e,n){e=t.wrapAsProperty(e),n.nodeValue=e.value(),e.subscribe(n,function(){n.nodeValue=e.value()})},n.bindStringInput=function(e,n){e=t.wrapAsProperty(e),n.value=e.value(),e.subscribe(n,function(){n.value=e.value()}),n.addEventListener("change",function(){e.set(n.value)})},n.bindStringElement=function(e,n){e=t.wrapAsProperty(e),n.textContent=e.value(),e.subscribe(n,function(){n.textContent=e.value()})},n.bindCheckbox=function(e,n,r,i){e=t.wrapAsProperty(e),n.checked=r?r(e.value()):e.value(),e.subscribe(n,function(){n.checked=r?r(e.value()):e.value()}),n.addEventListener("change",function(){e.set(i?i(n.checked):n.checked)})},n.bindAttributeToElementAttribute=function(e,t,n,r){var i=function(){var i=r?r(e.value()):e.value();"$remove"===i?n.removeAttribute(t):n.setAttribute(t,i)};i(),e.subscribe(n,function(){i()})},n.bindObject=function(e,r,i,a){e=t.wrapAsProperty(e),null!==e.value()&&i(e,r,null,a),"simple"!==n.getType(e.value())&&e.subscribe(r,function(){n.unbindChildren(r),r.innerHTML="",null!==e.value()&&i(e,r,null,a)})},n.bindList=function(e,r,i){e=t.wrapAsProperty(e);var a=function(){},o=function(e,n,r,o){var s=t.listItemProperty(e,n);i(s,r,o),s.subscribe(r.children.item(n),a)},s=function(e){if(n.unbindChildren(r),r.innerHTML="",e)for(var t=0;t<e.length;t++)o(e,t,r,null)};s(e.value()),e.subscribe(r,function(i){var a=e.value();switch(i.message.type){case t.PROP_EVENT_TYPE_CHANGE:s(e.value());break;case t.PROP_EVENT_TYPE_CHANGE_PUSH:o(a,a.length-1,r,null);break;case t.PROP_EVENT_TYPE_CHANGE_SPLICE:var u=i.message.originalEvent.message.args,l=u[0],d=u[1],c=r,p=c.children;for(m=0;d>m;++m){var v=p.item(l);n.unbind(v),v.parentNode.removeChild(v)}for(var f=p.item(l),m=2;m<u.length;++m)o(a,l+m-2,c,f)}})},n.bindDict=function(r,i,a){r=t.wrapAsProperty(r);var o=function(n,r,i){var a={key:r,origKey:r,value:i};return e.setAutoDelete(a,2),t.generateSetter(a,"key"),t.generateSetter(a,"value"),e.subscribe(a,"setValue",a,function(e){n.dictSet(a.key,e.message.args[0])}),e.subscribe(a,"setKey",a,function(){n.dictDel(a.origKey),n.dictSet(a.key,a.value)}),e.subscribe(n,"ValueChanged",a,function(e){e.message.key===a.key&&a.value!==e.message.value&&a.setValue(e.message.value)}),a},s=function(){var s=r.value();s.dictSet=s.dictSet||function(t,n){void 0!==this[t]?(this[t]=n,e.raiseEvent(this,"ValueChanged",{key:t,value:n})):(this[t]=n,e.raiseEvent(this,"KeyAdded",{key:t,value:n}))},s.dictDel=s.dictDel||function(t){delete this[t],e.raiseEvent(this,"KeyDeleted",t)};var u=[];e.setAutoDelete(u,0);for(var l in s)if(s.hasOwnProperty(l)){var d=s[l];"function"!=typeof d&&"_"!==l[0]&&u.push(o(s,l,d))}var c=t.staticProperty(u);n.bindList(c,i,a),e.subscribe(s,"KeyAdded",u,function(e){var t=e.message.key,n=e.message.value;u.push(o(s,t,n))}),e.subscribe(s,"KeyDeleted",u,function(e){for(var t=e.message,n=0;n<u.length;n++){var r=u[n];if(r.origKey===t)return void u.splice(n,1)}})};s(),r.subscribe(i,function(){n.unbindChildren(i),i.innerHTML="",s()})},n.maxId=0,n.generateId=function(){return++n.maxId},n.script=function(e){var t=document.getElementsByTagName("SCRIPT"),n=t.item(t.length-1);n.templateScript=e},window.dobi=window.dobi||{},window.dobi.script=n.script,n.Environment=function(){this.init.apply(this,arguments)},n.Environment.prototype={init:function(){this.stack=[]},push:function(e){this.stack.push(e),this.data=this.stack[this.stack.length-1]},clone:function(){var e=new n.Environment;return e.stack=this.stack.slice(0),e}},n.getType=function(e){if("string"==typeof e)return"simple";if("number"==typeof e)return"simple";if("boolean"==typeof e)return"simple";if("object"==typeof e)return"[object Array]"===Object.prototype.toString.call(e)?"list":"object";throw"Not supported type:"+typeof e},n.transformations={},n.parseTransformationFromTemplate=function(e,t,r){return function(){new n.TemplateExecutor(e,t,r,arguments).execute()}},n.insertNode=function(e,t,n){n?t.insertBefore(e,n):t.appendChild(e)},n.TemplateExecutor=function(){this.init.apply(this,arguments)},n.TemplateExecutor.prototype={init:function(e,t,r,i){this.node=e,this.env=t?t.clone():new n.Environment,this.env.push({transId:n.generateId(),self:i[0],node:i[1],refNode:i[2]});var a=i[3];if(a)for(var o=0;o<a.length;++o){var s=a[o];this.env.data["param"+o]=s;var u=r[o];u&&(this.env.data[u]=s)}},execute:function(){this.cloneChildrenNodes(this.node,this.env.data.node,this.env.data.refNode)},cloneChildrenNodes:function(e,t,n){for(var r=0;r<e.childNodes.length;++r){var i=e.childNodes.item(r);this.cloneNode(i,t,n)}},parseTemplateDefAttribute:function(e){var t={templateName:null,parameterNames:[]},n=e.split(new RegExp("\\(([^\\)]+)\\)"));t.templateName=n[0];var r=n[1];if(!r)return t;r=r.split(",");for(var i=0;i<r.length;i++){var a=r[i];t.parameterNames.push(a.trim())}return t},processDefTemplate:function(e){if(!e.getAttribute||!e.getAttribute("data-def-template"))return!1;var t=e.getAttribute("data-def-template");e.removeAttribute("data-def-template");var r=this.parseTemplateDefAttribute(t);return n.transformations[r.templateName]=n.parseTransformationFromTemplate(e,this.env,r.parameterNames),e.parentNode.removeChild(e),!0},processTextNode:function(e,t,r){if(e.nodeType!==Node.TEXT_NODE)return!1;for(var i=e.nodeValue.split(new RegExp("{{([^}]+)}}")),a=0;a<i.length;a++){var o,s=i[a];if(a%2===0)o=document.createTextNode(s);else{var u=this.resolveBinding(s);if("simple"!==n.getType(u.value()))continue;o=document.createTextNode(""),n.bindString(u,o)}r?t.insertBefore(o,r):t.appendChild(o)}return!0},processElementAttributes:function(e){if(e.hasAttribute)for(var t=new RegExp("{{(.*)}}"),r=0;r<e.attributes.length;r++){var i=e.attributes.item(r),a=t.exec(i.value);if(a){var o=a[1],s=this.resolveBinding(o);if("simple"!==n.getType(s.value()))return;var u;"IMG"===e.tagName&&"data-src"===i.name?(e.removeAttribute(i.name),u="src"):u=i.name,n.bindAttributeToElementAttribute(s,u,e)}}},processScript:function(e,t,n){var r=this;if(!e.tagName||"SCRIPT"!==e.tagName||!e.templateScript)return!1;var i={env:this.env,parentNode:t,refNode:n,getElementById:function(e){return document.getElementById(e+"#"+this.env.data.transId)},resolve:function(e){return r.resolveBinding(e)},resolveValue:function(e){return this.resolve(e).value()}};return e.templateScript.apply(e,[i]),!0},cloneNode:function(e,t,r){if(!this.processDefTemplate(e)&&!this.processTextNode(e,t,r)&&!this.processScript(e,t,r)){var i=e.cloneNode(!1);i.hasAttribute&&i.hasAttribute("id")&&i.setAttribute("id",i.getAttribute("id")+"#"+this.env.data.transId),this.processElementAttributes(i),n.insertNode(i,t,r);var a=this.parseBindAttribute(e);if(!a)return void this.cloneChildrenNodes(e,i);if(a.property){var o=this.getTransformation(e);switch(a.type){case"list":n.bindList(a.property,i,o);break;case"dict":n.bindDict(a.property,i,o);break;case"object":n.bindObject(a.property,i,o,this.getTransformationParameters(e));break;case"simple":o?n.bindObject(a.property,i,o,this.getTransformationParameters(e)):n.bindString(a.property,i)}}}},parseBindAttribute:function(e){if(!e.getAttribute)return!1;var t=e.getAttribute("data-bind");if(!t)return!1;var r=t.split(new RegExp(":")),i={};if(1===r.length?(i.property=this.resolveBinding(r[0]),i.property&&(i.type=n.getType(i.property.value())),i.path=t):(i.property=this.resolveBinding(r[1]),i.type=r[0],i.path=t),null===i.property)throw"Cannot resolve binding:"+t;return i},resolveBinding:function(e){var n=this;if("Name"===e);var r=function(e){for(var t=0;0===e.indexOf("../");)t++,e=e.slice(3);return{parentLevel:t,path:e}},i=function(e,r,i){for(var a=e;a>=0;--a){var o=n.env.stack[a],s=o[r];if(void 0!==s)return s instanceof t.Property||(s=t.staticProperty(s)),i?t.objectProperty(s.value(),i):s}return null},a=r(e),o=n.env.stack.length-a.parentLevel-1;if(e=a.path,"/"===e[0]&&(o=0,e=e.slice(1)),""===e||"."===e)return n.env.stack[o].self;"./"===e.slice(0,2)&&(e=e.slice(2));var s=e.split(new RegExp("[/]"),2),u=i(o,s[0],s[1]);return u?u:u=i(o,"self",e)},getTransformation:function(e){if(e.hasAttribute("data-template")){var t=e.getAttribute("data-template");return n.transformations[t]}return e.childNodes.length>0?n.parseTransformationFromTemplate(e,this.env):null},getTransformationParameters:function(e){var t=[];if(!e.hasAttribute("data-template-parameters"))return t;for(var n=e.getAttribute("data-template-parameters").split(","),r=0;r<n.length;r++){var i=n[r];t.push(this.resolveBinding(i))}return t}},n})}();