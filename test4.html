<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">

    <LINK href="test2.css" rel="stylesheet" type="text/css">
    <!--    <script src="../lib/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="../lib/require.js" data-main="test3.js"></script>-->

    <script src="eventing.js"></script>
    <script src="dombinding.js"></script>
    <title>Binding Declarative Approach</title>

</head>

<body>

    <div data-def-template="dropdown(obj,objContext,items)">
        <select data-bind="items">
            <option data-bind="$self">
                <script>
                    dombinding.templateScript(function(ctx,item,itemList){
                        var object = ctx.env.value("../$1/obj");
                        var attributeName = ctx.env.value("../$1/attributeName");                        
                        dombinding.bindAttributeToElementAttribute(object,attributeName,ctx.parentNode,'selected',function(value){
                            if(value===item)
                                return "selected";
                            else
                                return "$remove";
                        });
                    });
                </script>
            </option>
        </select>
    </div>


    <div data-bind="salesOrder">
        <h1>Sales Order:

        </h1>

        <input data-bind="description">

        <h2>Status</h2>

        <div data-bind="status.code" data-template="dropdown" data-template-parameters="codes"></div>

        <div data-bind="status">
            Status code:
            <span data-bind="code"></span>
            <br>Description:
            <span data-bind="description"></span>
        </div>

        <h2>Items</h2>
        <ul data-bind="items">
            <li>
                <span data-bind="../items/0/description"></span>
                <span data-bind="description"></span>
                So, jetzt kommt ein Test: {{description}} {{../description}} Ende des Tests.
                <ul data-bind="subitems">
                    <li>
                        <input data-bind="$self">
                        <span data-bind="$self"></span>
                    </li>
                </ul>
                <button id="delitems">Del</button>
                <script>
                    dombinding.templateScript(function(ctx,item,list){
                        var delButton=document.getElementById("delitems#"+ctx.id);
                        delButton.addEventListener('click',function(){
                            var index = list.indexOf(item);
                            list.splice(index,1);
                        })
                    });
                </script>
            </li>
        </ul>
        <button id="additem">Add</button>
        <script>
            dombinding.templateScript(function(ctx,salesOrder){
                var addButton=document.getElementById("additem#"+ctx.id);
                addButton.addEventListener('click',function(){
                    salesOrder.items.push({description:'new', subitems:['a']});
                });
            });
        </script>
    </div>

    <div id="testtext"></div>

    <script>
        codes = [1,2,3];
        
        salesOrder = {
                    id: 10,
                    description: 'Big Order',
                    status: {
                        code: 2,
                        description: 'Status 1'
                    },
                    items: [
                        {
                            description: 'item1',
                            subitems: ['a', 'b', 'c']
                    },
                        {
                            description: 'item2',
                            subitems: ['x', 'y', 'z']
                    }
                ]
                };
    </script>


</body>

</html>